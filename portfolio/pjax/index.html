
<html charset='utf-8'>
  <head>

    <title>我的pjax路由器试验田</title>
  </head>

  <body class="" ms-controller='vm'>

    <center>
      <a class="" href='#/home'>home</a>
      <a class="" href='#/module'>module</a>
      <a class="" href='#/login'>login</a>
    </center>
<!--粤B0J4H7-->
    <script src="/src/js/avalon.20160424.js"></script>
    <script>
var vm= avalon.define({
  $id: 'vm'
})
//location.query prepared for amplitude log event
//;location.search.substr(1).split('&').forEach(function(el){
//  location.query= location.__proto__.query|| {}
//  location.query[el.split('=')[0]]= el.match('=')?
//    decodeURIComponent(el.split('=')[1])
//    :
//    null
//});

;(function(location){
  //fn: parse the location.search into url queries
  var _query= function(prop){
    var search= location.search.substr(1)
    var query= {}
    search.split('&').forEach(function(str, index){
      var k= str.split('=')[0]
      var v= str.match('=')?
        decodeURIComponent(str.split('=')[1])
        :
        null//js中null本意为'此处不应该有值'
      query[k]= v
    })
    if(prop===''|| prop===undefined){
      return query
    }
    else{
      return query[prop]
    }
  }
  location.__proto__.query= _query
})(window.location);

;(function(location){
  var _router= (function(){
    var router= {
      config: function(){
        return {
          path: this.path()
        }
      }
      ,path: function(url, callback){
        console.info(location.href, url)
        if(url!== ''&& url!== undefined){
          return (function(url, callback){
            location.hash= url.substr(url.indexOf('#'))>0?
              url.substr(url.indexOf('#'))
              :
              url
            ;typeof callback=== 'function'&& callback()|| console.warn('invalid callback function~');
          })(url, callback)
        }
        return [
          {
            url: '/'
            ,params: {}
          }
        ]
      }
    }
    window.addEventListener('hashchange', function(eve){
      console.info(currURL= eve.newURL, lastURL= eve.oldURL)
      console.info(eve.newURL.substr(eve.newURL.lastIndexOf('#')), eve.oldURL)
    })
    return router
  })()
  location.__proto__.router= _router

  console.log(location.query(), location.router)
})(window.location);
    </script>
  </body>
</html>
